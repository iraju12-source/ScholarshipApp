<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Master Application View - {{ app['full_name'] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding-top: 20px; }
        .paper-container { background: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 30px; }
        .header-section { background: #2c3e50; color: white; padding: 25px 40px; border-bottom: 5px solid #f39c12; }
        .section-title { background: #f8f9fa; border-left: 4px solid #f39c12; padding: 8px 15px; margin: 25px 0 15px 0; font-weight: bold; color: #2c3e50; text-transform: uppercase; font-size: 0.9rem; }
        .data-label { font-weight: 600; color: #7f8c8d; font-size: 0.85rem; margin-bottom: 2px; }
        .data-value { color: #006400; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; font-weight: 500; min-height: 1.5rem;}
        .attachment-card { background: #f0fdf4; border: 1px dashed #22c55e; border-radius: 5px; padding: 10px; margin-bottom: 10px; transition: 0.3s; }
        .attachment-card:hover { background: #dcfce7; }
        .btn-back { margin-bottom: 20px; margin-left: 15px; }
    </style>
</head>
<body>
    <div class="container-fluid px-4">
        <a href="{{ url_for('dashboard_router') }}" class="btn btn-outline-secondary btn-sm btn-back">‚Üê Back to Dashboard</a>
        
        <div class="paper-container">
            <div class="header-section">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="mb-0">{{ app['full_name'] }}</h1>
                        <p class="mb-0 opacity-75">Student ID: #{{ app['student_id'] }} | Submitted: {{ app['submission_date'] }}</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <span class="badge bg-warning text-dark fs-5 px-3">{{ app['status'] }}</span>
                    </div>
                </div>
            </div>

            <div class="p-4 p-md-5">
                <div class="row">
                    <div class="col-lg-8 border-end">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="section-title">1. Personal Information</div>
                                <p class="data-label">Date of Birth</p><p class="data-value">{{ app['dob'] }}</p>
                                <p class="data-label">Gender</p><p class="data-value">{{ app['gender'] }}</p>
                                <p class="data-label">Aadhaar Number</p><p class="data-value">{{ app['aadhaar_number'] }}</p>
                                <p class="data-label">Email Address</p><p class="data-value">{{ app['email'] }}</p>
                                <p class="data-label">Mobile (Primary)</p><p class="data-value">{{ app['mobile_primary'] }}</p>
                                <p class="data-label">Mobile (Secondary)</p><p class="data-value">{{ app['mobile_secondary'] or 'N/A' }}</p>

                                <div class="section-title">3. Socio-Economic Details</div>
                                <p class="data-label">Father's Name & Occupation</p><p class="data-value">{{ app['father_name'] }} ({{ app['father_occupation'] }})</p>
                                <p class="data-label">Mother's Name & Occupation</p><p class="data-value">{{ app['mother_name'] }} ({{ app['mother_occupation'] }})</p>
                                <p class="data-label">Annual Family Income</p><p class="data-value">‚Çπ{{ app['annual_income'] }}</p>
                                <p class="data-label">Housing Type</p><p class="data-value">{{ app['housing_type'] }}</p>
                                <p class="data-label">Dependents</p><p class="data-value">{{ app['dependents'] }}</p>

                                <div class="section-title">5. References</div>
                                <p class="data-label">Reference 1</p>
                                <p class="data-value">{{ app['ref1_name'] }} | {{ app['ref1_contact'] }} ({{ app['ref1_relation'] }})</p>
                                <p class="data-label">Reference 2</p>
                                <p class="data-value">{{ app['ref2_name'] }} | {{ app['ref2_contact'] }} ({{ app['ref2_relation'] }})</p>
                            </div>

                            <div class="col-md-6">
                                <div class="section-title">2. Academic Background</div>
                                <p class="data-label">SSLC School (% / Marks)</p>
                                <p class="data-value">{{ app['sslc_school'] }} ({{ app['sslc_percent'] }}% | {{ app['sslc_marks'] }})</p>
                                
                                <p class="data-label">HSC School (% / Marks)</p>
                                <p class="data-value">{{ app['hsc_school'] }} ({{ app['hsc_percent'] }}% | {{ app['hsc_marks'] }})</p>
                                
                                <p class="data-label">Current College & Course</p>
                                <p class="data-value">{{ app['current_college'] }} - {{ app['current_course'] }}</p>
                                
                                <p class="data-label">Current CGPA</p>
                                <p class="data-value">{{ app['cgpa'] }}</p>

                                <div class="section-title">4. Skills & Talents</div>
                                <p class="data-label">Special Talents / Extracurriculars</p>
                                <p class="data-value">{{ app['talents'] or 'None listed' }}</p>

                                <div class="section-title">6. Submitted Attachments</div>
                                {% set docs = [
                                    ('written_test_pdf', 'Written Test Answer Sheet'),
                                    ('aadhaar_card_file', 'Aadhaar Card Copy'),
                                    ('sslc_marksheet_file', 'SSLC Marksheet'),
                                    ('hsc_marksheet_file', 'HSC Marksheet'),
                                    ('semester_marksheet_file', 'College Marksheet')
                                ] %}

                                <div class="row">
                                    {% for key, label in docs %}
                                    <div class="col-12">
                                        <div class="attachment-card d-flex justify-content-between align-items-center mb-2">
                                            <div class="overflow-hidden">
                                                <small class="text-muted d-block" style="font-size: 0.65rem;">{{ label }}</small>
                                                <span class="fw-bold small">{% if app[key] %}{{ app[key][:30] }}...{% else %}Not Available{% endif %}</span>
                                            </div>
                                            {% if app[key] %}
                                            <a href="{{ url_for('download', filename=app[key]) }}" target="_blank" class="btn btn-sm btn-success py-1 px-3">View</a>
                                            {% else %}
                                            <span class="badge bg-secondary">N/A</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 ps-lg-4">
                        <div class="section-title mt-lg-0">Evaluator Assessment</div>
                        <div class="p-3 border rounded bg-white shadow-sm mb-4">
                            <div class="mb-3 border-bottom pb-2">
                                <p class="data-label mb-0">Total Evaluator Score</p>
                                <h4 class="text-success">{{ app['evaluator_score'] or '0' }} <small class="text-muted fs-6">/ 80</small></h4>
                            </div>

                            <div class="row g-2">
                                <div class="col-12 mb-2">
                                    <div class="p-2 bg-light border-start border-primary border-3">
                                        <p class="data-label mb-0 text-primary">Academic Weightage (Automated)</p>
                                        <p class="data-value mb-0 fw-bold border-0">{{ (app['hsc_percent']|float / 4)|round(2) }} / 25</p>
                                    </div>
                                </div>
                                <div class="col-6 small"><p class="data-label mb-0">Written Marks</p><b>{{ app['written_marks'] or 0 }}/20</b></div>
                                <div class="col-6 small"><p class="data-label mb-0">Communication</p><b>{{ app['comm_marks'] or 0 }}/5</b></div>
                                <div class="col-6 small"><p class="data-label mb-0">Economic Status</p><b>{{ app['econ_marks'] or 0 }}/5</b></div>
                                <div class="col-6 small"><p class="data-label mb-0">Parental Status</p><b>{{ app['parent_marks'] or 0 }}/5</b></div>
                                <div class="col-6 small"><p class="data-label mb-0">Form Details</p><b>{{ app['details_marks'] or 0 }}/5</b></div>
                                <div class="col-6 small"><p class="data-label mb-0">Own Remarks</p><b>{{ app['own_remarks_marks'] or 0 }}/5</b></div>
                                <div class="col-12 small"><p class="data-label mb-0">Special Talent</p><b>{{ app['talent_marks'] or 0 }}/10</b></div>
                            </div>

                            <hr>
                            <p class="data-label mb-1">Evaluator Recommendation</p>
                            <span class="badge {% if app['evaluator_recommendation'] == 'Recommended' %}bg-success{% elif app['evaluator_recommendation'] == 'Waitlisted' %}bg-warning text-dark{% else %}bg-danger{% endif %} mb-2">
                                {{ app['evaluator_recommendation'] or 'NOT EVALUATED' }}
                            </span>
                            <p class="data-label mb-1">Evaluator Comments</p>
                            <p class="small italic text-muted p-2 bg-light rounded border">{{ app['evaluator_comments'] or 'No comments provided.' }}</p>
                        </div>
               
                        {% if session['role'] in ['admin', 'coordinator'] %}
                        <div class="section-title">Final Selection Decision</div>
                        <div class="p-3 border rounded bg-dark text-white shadow-sm mb-4">
                            <div class="mb-3 border-bottom border-secondary pb-2">
                                <p class="data-label mb-0 text-warning">Final Combined Score (100)</p>
                                <h4 class="text-white">{{ (app['evaluator_score']|float + (app['interview_marks']|default(0)|float))|round(2) }} <small class="text-muted fs-6">/ 100</small></h4>
                            </div>

                            <p class="data-label mb-0 text-secondary text-uppercase small">Interview Marks (20)</p>
                            <p class="fw-bold text-warning mb-2">{{ app['interview_marks'] or 0 }} / 20</p>
                            
                            <p class="data-label mb-0 text-secondary text-uppercase small">Status Decision</p>
                            <span class="badge {% if app['final_decision'] == 'Scholarship Approved' %}bg-success{% elif app['final_decision'] == 'Wait Listed' %}bg-primary{% else %}bg-danger{% endif %} mb-2">
                                {{ app['final_decision'] or 'PENDING' }}
                            </span>

                            <p class="data-label mb-0 text-secondary text-uppercase small">Final Selection Remarks</p>
                            <p class="small text-light mb-0">{{ app['final_comments'] or 'No final remarks.' }}</p>
                            
                            {% if app['interview_doc'] %}
                            <div class="mt-3 pt-3 border-top border-secondary">
                                <a href="{{ url_for('download', filename=app['interview_doc']) }}" target="_blank" class="btn btn-sm btn-outline-warning w-100">
                                    üì• Download Final Interview Document
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}    
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>